#!/bin/sh
set -e

# Builds the jsdoc and publishes it to the gh-pages branch

TARGET_PROJECT="$(pwd)/../simplicity-gh-pages"

if [ ! -d "$TARGET_PROJECT" ]; then
    echo >&2 "Target project not found: $TARGET_PROJECT"
    exit 1
fi

echo "Building and copying jsdoc"
rm -rf "$TARGET_PROJECT/jsdoc"
ant clean jsdoc
cp -r docroot/jsdoc "$TARGET_PROJECT/"

echo "Committing jsdoc"
cd "$TARGET_PROJECT"
git fetch t11e
git merge --ff-only t11e/gh-pages
git add --all jsdoc
git commit -m "[publish_jsdoc] Updates jsdoc."

echo "Publishing jsdoc"
git push t11e gh-pages
